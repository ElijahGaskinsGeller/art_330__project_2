<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ThreeJS Panel Test</title>
    <script src="./js/core-functionality.js"></script>
</head>

<body style="margin: 0; padding: 0; height: 500vh;">

<!--<canvas id="c" width="1920px" height="1080px" style="position: fixed; width: 100%; height: 100%;"></canvas>-->

<script type="x-shader/x-vertex" id="vertexshader">

			attribute float size;
			attribute float opacity;

			out float vOpacity;


			void main() {

                vOpacity = opacity;

				vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

				gl_PointSize = size * ( 300.0 / -mvPosition.z );

				gl_Position = projectionMatrix * mvPosition;

			}







</script>

<script type="x-shader/x-fragment" id="fragmentshader">

			uniform sampler2D pointTexture;

			in float vOpacity;

			void main() {

				gl_FragColor = vec4( 1.0, 1.0, 1.0 , vOpacity );

				gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord );

			}







</script>

<script type="module">


    import * as THREE from "./js/threejs/three.module.js";
    import {FBXLoader} from "./js/threejs/jsm/loaders/FBXLoader.js";

    const scene = new THREE.Scene();
    let camera = new THREE.PerspectiveCamera( 50, window.innerWidth / window.innerHeight, 0.1, 1000 );
    let cameraStartPosition = {x: 0, y:0, z:0};

    let renderer = new THREE.WebGLRenderer();

    renderer.setSize( window.innerWidth, window.innerHeight );
    renderer.shadowMap.enabled = true;

    document.body.appendChild( renderer.domElement );

    renderer.domElement.style = "position: fixed; width: 100%; height: 100%;";

    let loader = new FBXLoader();

    loader.load("./models/test_scene__1.fbx",
        function(object){

            console.log(object);
            let material = new THREE.MeshPhongMaterial({color: 0x00ff00});

            let directionalLight = new THREE.DirectionalLight(0xffffff);
            directionalLight.position.z = 90;
            directionalLight.castShadow = true;
            // let ambientLight = new THREE.AmbientLight(0xffffff, .5);
            let ambientLight = new THREE.AmbientLight(0xffffff, .5);
            scene.add(ambientLight);
            scene.add(directionalLight);


            for(let i = 0; i < object.children.length; i++){

                let currentObject = object.children[i];
                let currentMaterial = new THREE.MeshPhongMaterial({color: new THREE.Color(Math.random(),Math.random(),Math.random())});

                //TODO: change to "camera_position"
                if(currentObject.name == "Cube004"){

                    cameraStartPosition = currentObject.position;

                    // camera.position.x = currentObject.position.x;
                    // camera.position.y = currentObject.position.y;
                    // camera.position.z = currentObject.position.z + 100;

                    console.log("here");
                }

                currentObject.material = currentMaterial;
                currentObject.receiveShadow = true;
                currentObject.scale.x = 1;
                currentObject.scale.y = 1;
                currentObject.scale.z = 1;
                // scene.add(object.children[i]);

            }

            scene.add(object);
            scroll();

        }
    );

    // const geometry = new THREE.BoxGeometry( 1, 1, 1 );
    // const material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
    // const cube = new THREE.Mesh( geometry, material );
    // scene.add( cube );

    camera.position.z = 500;

    window.addEventListener("resize",function (e){
        renderer.setSize( window.innerWidth, window.innerHeight );
        camera.aspect = window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
    });


    function scroll(){
        let scrollAmount = 400;
        // camera.position.y = -(scrollAmount*WindowScrollNormalPosition() - scrollAmount/2);
        camera.position.x = cameraStartPosition.x;
        camera.position.y = cameraStartPosition.y + lerp(10, 1, WindowScrollNormalPosition());
        // camera.position.y = cameraStartPosition.y;
        camera.position.z = 16;
        // camera.position.z = lerp(6000, -6000, WindowScrollNormalPosition());

        console.log(camera.position);

    }


    function animate() {
        requestAnimationFrame( animate );
        renderer.render( scene, camera );
    }

    animate();
    scroll();

    document.addEventListener("scroll", scroll);

</script>
</body>
</html>

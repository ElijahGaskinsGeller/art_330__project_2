<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ThreeJS Panel Test</title>
    <script src="./js/core-functionality.js"></script>
</head>

<body style="margin: 0; padding: 0; height: 500vh;">

<!--<canvas id="c" width="1920px" height="1080px" style="position: fixed; width: 100%; height: 100%;"></canvas>-->

<script type="x-shader/x-vertex" id="vertexshader">

			attribute float size;
			attribute float opacity;

			out float vOpacity;


			void main() {

                vOpacity = opacity;

				vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

				gl_PointSize = size * ( 300.0 / -mvPosition.z );

				gl_Position = projectionMatrix * mvPosition;

			}







</script>

<script type="x-shader/x-fragment" id="fragmentshader">

			uniform sampler2D pointTexture;

			in float vOpacity;

			void main() {

				gl_FragColor = vec4( 1.0, 1.0, 1.0 , vOpacity );

				gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord );

			}







</script>

<script type="module">


    import * as THREE from "./js/threejs/three.module.js";
    import {FBXLoader} from "./js/threejs/jsm/loaders/FBXLoader.js";

    const scene = new THREE.Scene();
    let camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

    let renderer = new THREE.WebGLRenderer();

    renderer.setSize( window.innerWidth, window.innerHeight );

    document.body.appendChild( renderer.domElement );

    renderer.domElement.style = "position: fixed; width: 100%; height: 100%;";

    let loader = new FBXLoader();

    loader.load("./models/test_model.fbx",
        function(object){

            console.log(object);
            let material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );

            for(let i = 0; i < object.children.length; i++){

                object.children[i].material = material;
                // scene.add(object.children[i]);

            }

            scene.add(object);

        }
    );

    // const geometry = new THREE.BoxGeometry( 1, 1, 1 );
    // const material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
    // const cube = new THREE.Mesh( geometry, material );
    // scene.add( cube );

    camera.position.z = 500;

    window.addEventListener("resize",function (e){
        renderer.setSize( window.innerWidth, window.innerHeight );
        camera.aspect = window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
    });


    function scroll(){
        let scrollAmount = 400;
        camera.position.y = -(scrollAmount*WindowScrollNormalPosition() - scrollAmount/2);
    }


    function animate() {
        requestAnimationFrame( animate );
        renderer.render( scene, camera );
    }

    animate();
    scroll();

    document.addEventListener("scroll", scroll);

</script>
</body>
</html>
